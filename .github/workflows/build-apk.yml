name: Android CI Fixed

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: gradle

      - name: Setup Android SDK
        uses: android-actions/setup-android@v3

      - name: Fix gradlew file issues
        run: |
          # 删除有问题的 gradlew 文件
          rm -f gradlew
          
          # 重新生成 gradlew
          gradle wrapper --gradle-version 8.2.1 --distribution-type all
          
          # 确保执行权限
          chmod +x gradlew
          
          # 验证 gradlew 文件
          head -10 gradlew
          echo "Gradle wrapper 已重新生成"

      - name: Build with Gradle directly
        run: |
          # 使用重新生成的 gradlew 构建
          ./gradlew tasks --no-daemon || echo "Gradle tasks 查看完成"
          
          # 尝试构建，如果失败则使用备用任务名
          ./gradlew assembleDebug --no-daemon --
