name: Simple APK Build

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Build APK
      run: |
        # 一键安装所有依赖
        sudo apt update && sudo apt install -y android-sdk-build-tools-34 gradle openjdk-11-jdk
        
        # 创建最简单的项目
        mkdir -p app/src/main/java/com/example/app
        cat > app/build.gradle << 'EOF'
        plugins { id 'com.android.application' }
        android {
            compileSdk 34
            defaultConfig {
                applicationId "com.example.app"
                minSdk 21
                targetSdk 34
            }
        }
        dependencies { implementation 'androidx.appcompat:appcompat:1.6.1' }
        EOF
        
        echo "include ':app'" > settings.gradle
        
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <manifest xmlns:android="http://schemas.android.com/apk/res/android">
            <uses-permission android:name="android.permission.INTERNET" />
            <application android:label="App">
                <activity android:name=".MainActivity" android:exported="true">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                </activity>
            </application>
        </manifest>
        EOF
        
        cat > app/src/main/java/com/example/app/MainActivity.java << 'EOF'
        package com.example.app;
        import android.app.Activity;
        import android.os.Bundle;
        import android.webkit.WebView;
        public class MainActivity extends Activity {
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                WebView webView = new WebView(this);
                webView.getSettings().setJavaScriptEnabled(true);
                webView.loadUrl("https://powertech0417.github.io/Cv_ap/");
                setContentView(webView);
            }
        }
        EOF
        
        # 构建 APK
        gradle assembleDebug --stacktrace
        
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: simple-apk
        path: app/build/outputs/apk/debug/app-debug.apk
