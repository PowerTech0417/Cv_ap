name: Real APK Builder

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build Real APK with Capacitor
      run: |
        echo "ğŸš€ å¼€å§‹æ„å»ºçœŸæ­£çš„ APK..."
        
        # å®‰è£… Node.js å’Œ Capacitor
        curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
        sudo apt-get install -y nodejs
        
        # åˆ›å»º Capacitor é¡¹ç›®
        npx @capacitor/create-app@latest my-app --web-dir dist --app-name "æˆ‘çš„ç®€å†" --package-id "com.powertech0417.cvapp"
        cd my-app
        
        # é…ç½® Capacitor
        npm install @capacitor/android
        npx cap add android
        
        # ä¿®æ”¹é…ç½®ä»¥åŠ è½½æ‚¨çš„ç½‘é¡µ
        cat > src/index.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
            <title>æˆ‘çš„ç®€å†</title>
            <script>
                window.location.href = 'https://powertech0417.github.io/Cv_ap/';
            </script>
        </head>
        <body>
            <div style="text-align: center; padding: 50px;">
                <h1>æ­£åœ¨åŠ è½½...</h1>
                <p>å¦‚æœé¡µé¢æ²¡æœ‰è‡ªåŠ¨è·³è½¬ï¼Œè¯· <a href="https://powertech0417.github.io/Cv_ap/">ç‚¹å‡»è¿™é‡Œ</a></p>
            </div>
        </body>
        </html>
        EOF
        
        # æ„å»º Android APK
        npx cap build android
        
        # æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº† APK
        if [ -f "android/app/build/outputs/apk/debug/app-debug.apk" ]; then
            echo "ğŸ‰ APK æ„å»ºæˆåŠŸï¼"
            cp android/app/build/outputs/apk/debug/app-debug.apk ../my-resume.apk
        else
            echo "âŒ APK æ„å»ºå¤±è´¥ï¼Œä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆ"
        fi
        
    - name: Upload Real APK
      uses: actions/upload
