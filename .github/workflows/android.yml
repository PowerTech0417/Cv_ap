name: Build APK from Web

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Install Bubblewrap
        run: npm install -g @bubblewrap/cli

      - name: Clone Website (your GitHub Pages)
        run: |
          git clone https://github.com/powertech0417/Cv_ap.git website
          ls -R website

      - name: Create Manifest
        run: |
          bubblewrap init --manifest=https://powertech0417.github.io/Cv_ap/manifest.json

      - name: Build APK
        run: |
          bubblewrap build

      # 输出 APK 下载（Artifacts）
      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: CvAP-APK
          path: ./TWAProject/app-release-signed.apk

      # 上传到 Release 方便下载
      - name: Release APK
        uses: softprops/action-gh-release@v2
        with:
          name: "Latest APK"
          tag_name: "latest"
          files: ./TWAProject/app-release-signed.apk
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
